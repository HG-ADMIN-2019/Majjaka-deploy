{% extends 'root/base.html' %}
{% load static %}

{% block title %} project management {% endblock %}
{% block maincontent %}

{% include 'root/loader.html' %}
<style>
.toggle {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  display: block;
  height: auto;
  width: 7.5rem;
  margin: auto;
  cursor: pointer;
}
.toggle-input {
  display: none;
  margin: 0;
}
.toggle-off,
.toggle-on {
  height: 1.8125rem;
  width: 1.8125rem;
  color: rgba(46, 45, 44, 0.1);
  vertical-align: top;
  text-align: center;
  line-height: 1.8125rem !important;
}
.toggle-input:checked + .toggle-controller.default-success {
  border: 0.125rem solid rgba(108, 211, 61, 0.75);
  background: rgba(108, 211, 61, 0.375);
}
.toggle-input:checked + .toggle-controller.default-success:after {
  left: 1.5625rem;
}
.toggle-controller.default-success {
  position: relative;
  display: inline-block;
  height: 1.5625rem;
  width: 3.125rem;
  border: 0.125rem solid rgba(46, 45, 44, 0.05);
  -webkit-border-radius: 1.5625rem;
  -moz-border-radius: 1.5625rem;
  border-radius: 1.5625rem;
  -webkit-box-shadow: inset 0 0 0.1875rem rgba(46, 45, 44, 0.25);
  -moz-box-shadow: inset 0 0 0.1875rem rgba(46, 45, 44, 0.25);
  box-shadow: inset 0 0 0.1875rem rgba(46, 45, 44, 0.25);
  background: rgba(46, 45, 44, 0.025);
  -webkit-transition: all 0.25s ease;
  -moz-transition: all 0.25s ease;
  -o-transition: all 0.25s ease;
  transition: all 0.25s ease;
}
.toggle-controller.default-success:after {
  position: absolute;
  top: 0;
  left: 0;
  content: '';
  display: block;
  height: 1.5625rem;
  width: 1.5625rem;
  -webkit-border-radius: 1.5625rem;
  -moz-border-radius: 1.5625rem;
  border-radius: 1.5625rem;
  -webkit-box-shadow: 0 0.0625rem 0.125rem rgba(46, 45, 44, 0.2);
  -moz-box-shadow: 0 0.0625rem 0.125rem rgba(46, 45, 44, 0.2);
  box-shadow: 0 0.0625rem 0.125rem rgba(46, 45, 44, 0.2);
  background: white;
  -webkit-transition: all 0.25s ease;
  -moz-transition: all 0.25s ease;
  -o-transition: all 0.25s ease;
  transition: all 0.25s ease;
}
.toggle-off.active {color:red;}
.toggle-on.active {color:blue;}

#alert-message {
    color: red;
    font-size: 14px;
    padding: 10px;
    border: 1px solid red;
}

</style>
<div>
    <div>
        <div>
            <h1 class="h2">Enter Timesheet</h1>
        </div>
        <hr color="#ffa500">
        <div id="timesheet">
            <div id="select_project">
                <form>{% csrf_token %}
                    <span id="week_number" hidden>{{week_number}}</span>
                    <label for="choose_project">Select project to enter timesheet:</label>
                    <select id="choose_project" class="form-control form-control-sm">
                        <option value="">Select</option>
                        {% for project in project_details %}
                        <option value="{{project.project_id}}" data-desc="{{project.project_desc}}" data-start="{{project.start_date}}" data-end="{{project.end_date}}">{{project.project_id}}</option>
                        {% endfor %}
                    </select>
                    <div style="margin-top: 30px;" class="text-center">
                        <button type="button" id="get_project_detail_btn" class="btn btn-primary"
                            data-url="{% url 'eProc_Time_Sheet:get_project_details' %}"
                            onclick="get_project_details()">Submit</button>
                    </div>
                </form>
            </div>
            <br>
            <br>
            <div id="project_det_div" style="display:none;">
                <h1>Project Details</h1>
                <table class="table">
                    <tr>
                        <th>Project Id</th>
                        <td id="project_id"></td>
                    </tr>
                    <tr>
                        <th>Project Description</th>
                        <td id="project_desc"></td>
                    </tr>
                    <tr>
                        <th>Project Validity</th>
                        <td id="project_val"></td>
                    </tr>
                </table>
            </div>

            <br>
            <br>
            <div id="timesheet_entries">
                <h1>Timesheet Entries</h1>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Project ID</th>
                            <th>Username</th>
                            <th>Calendar ID</th>
                            <th>Project Category</th>
                            <th>Effort</th>
                            <th>Effort Day</th>
                            <th>Effort Date</th>
                            <th>Effort Week</th>
                            <th>Effort Year</th>
                            <th>Effort Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project_effort in project_efforts %}
                        <tr>
                            <td>{{ project_effort.project_id }}</td>
                            <td>{{ project_effort.username }}</td>
                            <td>{{ project_effort.calender_id }}</td>
                            <td>{{ project_effort.project_category }}</td>
                            <td>{{ project_effort.effort }}</td>
                            <td>{{ project_effort.effort_day }}</td>
                            <td>{{ project_effort.effort_date }}</td>
                            <td>{{ project_effort.effort_week }}</td>
                            <td>{{ project_effort.effort_year }}</td>
                            <td>{{ project_effort.effort_description }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<script>
// Function to show project details
function showProjectDetails(project) {
    $('#project_id').text(project.id);
    $('#project_desc').text(project.desc);
    $('#project_val').text(project.start + ' - ' + project.end);
    $('#project_det_div').show();
}

// Function to hide project details
function hideProjectDetails() {
    $('#project_id').text('');
    $('#project_desc').text('');
    $('#project_val').text('');
    $('#project_det_div').hide();
}

// Function to get project details
function get_project_details() {
    var projectId = $('#choose_project').val();
    var projectDesc = $('#choose_project').find(':selected').data('desc');
    var projectStart = $('#choose_project').find(':selected').data('start');
    var projectEnd = $('#choose_project').find(':selected').data('end');

    // Check if project ID is selected
    if (projectId) {
        var project = {
            'id': projectId,
            'desc': projectDesc,
            'start': projectStart,
            'end': projectEnd
        };
        showProjectDetails(project);
    } else {
        hideProjectDetails();
    }
}

// Function to add a new row
function addNewRow() {
    var projectID = $('#choose_project').val();
    var username = $('#username').val();
    var calendarID = $('#calendar_id').val();
    var projectCategory = $('#project_category').val();
    var effort = $('#effort').val();
    var effortDay = $('#effort_day').val();
    var effortDate = $('#effort_date').val();
    var effortWeek = $('#effort_week').val();
    var effortYear = $('#effort_year').val();
    var effortDescription = $('#effort_description').val();

    // Check if all fields are filled
    if (projectID && username && calendarID && projectCategory && effort && effortDay && effortDate && effortWeek && effortYear && effortDescription) {
        var newRow = '<tr>' +
                        '<td>' + projectID + '</td>' +
                        '<td>' + username + '</td>' +
                        '<td>' + calendarID + '</td>' +
                        '<td>' + projectCategory + '</td>' +
                        '<td>' + effort + '</td>' +
                        '<td>' + effortDay + '</td>' +
                        '<td>' + effortDate + '</td>' +
                        '<td>' + effortWeek + '</td>' +
                        '<td>' + effortYear + '</td>' +
                        '<td>' + effortDescription + '</td>' +
                     '</tr>';
        $('tbody').append(newRow);
        alert('New row added successfully!');
    } else {
        alert('Please fill all fields!');
    }
}

// Event listener for Submit button
$('#get_project_detail_btn').on('click', function() {
    get_project_details();
});

// Event listener for Add button
$('#add_row_btn').on('click', function() {
    addNewRow();
});

</script>

{% endblock %}
