{% extends 'root/base.html' %}
{% load static %}

{% block title %} Purchase Orders (SOM) {% endblock %}
{% block maincontent %}
<div class="container-fluid">
  <div class="mep-form_wrapper">
    <form method="POST">
      {% csrf_token %}
      <div class="d-flex justify-content-between">
        <h3>Sourcing Cockpit</h3>
      </div>

      <hr>

      <div class="card card-shadow-1">
        <div class="card-body">
          <div class="row">
            <div class="col-md">
              <label for="">SC Number</label>
              <input type="text" class="form-control check_for_search" id="sc_number" name="sc_number" >
            </div>
            <div class="col-md">
              <label for="">Product Category</label>
              <input type="text" class="form-control check_for_search" id="product_category" name="product_category">
            </div>
            <div class="col-md">
              <label for="">From Date</label>
              <input type="date" class="form-control check_for_search" id="from_date" name='from_date'>
            </div>
              <div class="col-md">
              <label for="">to Date</label>
              <input type="date" class="form-control check_for_search" id="to_date" name='to_date'>
            </div>
              <div class="col-md">
              <label for="">Company Code</label>
              <input type="text" class="form-control check_for_search" id="company_code" name="company_code">
            </div>

            <div class="col-auto my-1">
              <button class="button-search-users btn btn-primary" type="submit" name="sc_search"
                      title="Please click to get the search details!" onclick="reload()"><i class="fas fa-search"></i> search
              </button>
            </div>
          </div>
          <hr>
          <div class="elements-space-between" data-toggle="collapse" data-target="#supplier_adv_search">
            <span class="h5">Filter</span>
            <i class="fas fa-chevron-down"></i>
          </div>
          <div id="supplier_adv_search" class="advanced-search-collapse collapse">
            <div class="row">
              <div class="col-md">
                <label for="">Product category</label>
                <input type="checkbox" name="prod_cat_filter" value="prod_cat_filter">
              </div>
              <div class="col-md">
                <label for="">Supplier</label>
                <input type="checkbox" name="supplier_filter" value="supplier_filter">
              </div>
              <div class="col-md">
                <label for="">Product ID</label>
                <input type="checkbox" name="product_id_filter" value="product_id_filter">
              </div>
            </div>
          </div>
          <br>
          <div class="elements-space-between">
            <input type="reset" value="Clear filters" class="ip-form-clear-filters">
            <div>
              <span class="badge help-text-badge help-text-star-search"></span>
            </div>
          </div>

        </div>
      </div>
      {% if sc_header_item_details|length > 0 %}
      <div class="search_result_count_card card">
        <div class="card-body">
          <h6 class="card-title">Total number of results found :{{som_po_data|length}}</h6>
        </div>
      </div>
      {% elif sc_header_item_details|length == 0  %}
      <div class="search_result_count_card card">
        <div class="card-body">
          <h6 class="card-title">No Results Found</h6>
        </div>
      </div>
      {% endif %}

      {% if sc_header_item_details %}
      <div class="card">
        <div style="margin-top: 17px;margin-left: 10px;">
            <table id="sc_header_item" class="table table_sort_filter_export_excel">
                <thead class="thead-light">
                    <tr>
                        <th scope="col">SC Number</th>
                        <th scope="col">Description</th>
                        <th scope="col">Supplier ID</th>
                        <th scope="col">Company Code</th>
                        <th scope="col">Delivery Date</th>
                        <th scope="col">Unit</th>
                        <th scope="col">Quantity</th>
                        <th scope="col">Product Category</th>
                        <th scope="col">Select</th>
                    </tr>
                </thead>
                <tbody id="add_attr_body" >
                    {% for header_item in sc_header_item_details %}
                    <tr>
                        <td scope="row">{{ header_item.0 }}</td>
                        <td scope="row" class="hg-desc">{{ header_item.1 }}</td>
                        <td scope="row">{{ header_item.2 }}</td>
                        <td scope="row">{{ header_item.3 }}</td>
                        <td scope="row">{{ header_item.4 }}</td>
                        <td scope="row">{{ header_item.5 }}</td>
                        <td scope="row">{{ header_item.6 }}</td>
                        <td scope="row">{{ header_item.7 }}</td>
                        <td scope="row"><input type="checkbox" name="select" value="select"></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
<!--          <table id="som_po_table" class="table table_sort_filter_export_excel">-->
<!--            <thead class="thead-light">-->
<!--            <tr>-->
<!--              <th> PO Number  </th>-->
<!--              <th> Company Name </th>-->
<!--              <th> Buyer Name </th>-->
<!--              <th> Buyer Email </th>-->
<!--              <th> Buyer Phone No.</th>-->
<!--              <th> Received Date</th>-->
<!--              <th> Total Value</th>-->
<!--              <th>Action</th>-->
<!--            </tr>-->
<!--            </thead>-->
<!--            <tbody id="supplier_detail_tbody">-->
<!--            {% for results in som_po_data %}-->
<!--            <tr id="table-{{results.doc_number}}">-->
<!--              <td><a href="{% url 'eProc_Supplier_Order_Management:som_po_doc_details' results.encrypted_po_doc_num %}" id="{{results.doc_number}}" class="deletepop" target="_blank">{{results.doc_number}}</a></td>-->
<!--              <td>{{results.requester_company_name}}</td>-->
<!--              <td>{{results.requester}}</td>-->
<!--              <td>{{results.requester_email}}</td>-->
<!--              <td>{{results.requester_mobile_num}}</td>-->
<!--              <td>{{results.ordered_at}}</td>-->
<!--              <td>{{results.total_value}}</td>-->
<!--              <td><a href=\{{results.pdf_path}} type="application/pdf" target="_blank">View Po Pdf</a>-->
<!--              </td>-->
<!--            </tr>-->
<!--            {% endfor %}-->
<!--            </tbody>-->
<!--          </table>-->
        </div>
      </div>
      {% endif %}
    </form>
  </div>
</div>

<script>

$(document).ready( function() {
  nav_bar_shop_assist()
  table_sort_filter_export_excel();
  $('#po_number').val(localStorage.getItem("po_number"));
  $('#company_name').val(localStorage.getItem("company_name"));
  $('#received_date').val(localStorage.getItem("received_date"));
  $('#buyer_name').val(localStorage.getItem("buyer_name"));
  $('#buyer_email_id').val(localStorage.getItem("buyer_email_id"));
  $('#buyer_phone_num').val(localStorage.getItem("buyer_phone_num"));
});
function reload(){
      localStorage.setItem("po_number", document.getElementById("po_number").value);
      localStorage.setItem("company_name", document.getElementById("company_name").value);
      localStorage.setItem("received_date", document.getElementById("received_date").value);
      localStorage.setItem("buyer_name", document.getElementById("buyer_name").value);
      localStorage.setItem("buyer_email_id", document.getElementById("buyer_email_id").value);
      localStorage.setItem("buyer_phone_num", document.getElementById("buyer_phone_num").value);
      OpenLoaderPopup();
  }

document.getElementById("folder").addEventListener("change", function(event) {
  var output = document.querySelector("ul");
    formdata = new FormData();
  var attached_file = event.target.files;
    for (var i=0; i<attached_file.length; i++) {
    var item = document.createElement("li");
    item.innerHTML = attached_file[i].webkitRelativePath;
      formdata.append(i, $('input[type=file]')[0].files[i]);
    output.appendChild(item);
  };
  $.ajax({
    url: "{% url 'eProc_Supplier_Order_Management:upload_som' %}",
    type: 'POST',
    data: formdata,
    contentType: false,
    processData: false,
    success: function(response) {
      console.log(response);
      location.reload();
    },
    error: function(xhr, status, error) {
      console.log(xhr.responseText);
    }
});

}, false);
</script>
{% endblock %}